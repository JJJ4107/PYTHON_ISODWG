import fitz  # PyMuPDF
import sys
import os
import subprocess

# --------- ëª…ë ¹ì¤„ ì¸ì í™•ì¸ ----------
if len(sys.argv) != 3:
    print("ì‚¬ìš©ë²•: PDFFINDER.EXE [ì°¾ì„í…ìŠ¤íŠ¸] [PDFíŒŒì¼ê²½ë¡œ]")
    sys.exit()

TEXT = sys.argv[1]
PDF_PATH = sys.argv[2]

if not os.path.exists(PDF_PATH):
    print(f"âŒ PDF íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {PDF_PATH}")
    sys.exit()

# PDF ì—´ê¸° ë° í•˜ì´ë¼ì´íŠ¸ ì ìš©
doc = fitz.open(PDF_PATH)
found = False

def highlight_text(page, text, color=(1, 1, 0)):
    text_instances = page.search_for(text)
    for inst in text_instances:
        highlight = page.add_highlight_annot(inst)
        highlight.set_colors(stroke=color, fill=color)
        highlight.set_opacity(0.4)
        highlight.update()
    return len(text_instances)

for page_num, page in enumerate(doc, start=1):
    count = highlight_text(page, TEXT)
    if count > 0:
        print(f"âœ… {page_num} í˜ì´ì§€ì—ì„œ '{TEXT}' ë°œê²¬ ë° í•˜ì´ë¼ì´íŠ¸ë¨ ({count}íšŒ)")
        found = True

# ì„ì‹œ íŒŒì¼ë¡œ ì €ì¥ (ìë™ì‚­ì œ ëª©ì )
if found:
    import tempfile
    temp_file = tempfile.NamedTemporaryFile(delete=False, suffix=".pdf")
    doc.save(temp_file.name)
    doc.close()

    # ê¸°ë³¸ PDF ë·°ì–´ë¡œ ì—´ê¸°
    print("ğŸ“„ í™”ë©´ì— í‘œì‹œ ì¤‘...")
    subprocess.Popen(['start', '', temp_file.name], shell=True)
else:
    print(f"â— '{TEXT}' ë¥¼ PDFì—ì„œ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.")
    doc.close()
